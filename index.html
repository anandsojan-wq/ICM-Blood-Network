<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Blood Connect</title>
    
    <link rel="icon" type="image/png" href="logo.png">

    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { brand: '#08ABDE', brandDark: '#0090bd', bgGray: '#F2F4F6' },
                    fontFamily: { sans: ['Inter', 'sans-serif'] }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* APP LAYOUT - PREVENTS BOUNCING */
        html, body { height: 100%; overflow: hidden; background-color: #F2F4F6; -webkit-tap-highlight-color: transparent; }
        
        /* CONTENT AREA */
        .content-scroll { 
            height: 100%; 
            overflow-y: auto; 
            padding-bottom: 100px; /* Space for bottom nav */
            -webkit-overflow-scrolling: touch;
        }

        /* MODAL */
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); align-items: center; justify-content: center; padding: 20px; }
        .fade-in { animation: pop 0.2s ease-out forwards; }
        @keyframes pop { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* LOADER */
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid #08ABDE; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* PREVENT IOS ZOOM ON INPUTS */
        input, select { font-size: 16px !important; }
    </style>
</head>
<body class="font-sans text-slate-800 flex flex-col" onload="openStart()">

    <div id="startModal" class="modal" style="display:flex;">
        <div class="bg-white w-full max-w-sm p-6 rounded-3xl text-center fade-in shadow-2xl">
            <img src="logo.png" style="height: 60px; width: auto; margin: 0 auto 20px;" alt="Logo">
            
            <h1 class="text-xl font-bold mb-1">Blood Connect</h1>
            <p class="text-gray-400 text-xs mb-8 uppercase tracking-widest font-semibold">Kerala Region</p>

            <div class="grid grid-cols-2 gap-4">
                <button onclick="selectAppMode('reg')" class="bg-blue-50 border border-blue-100 p-6 rounded-2xl flex flex-col items-center justify-center gap-2 active:bg-blue-100 transition">
                    <span class="text-3xl">ü©∏</span>
                    <span class="text-[#08ABDE] font-bold text-sm">Donate</span>
                </button>
                <button onclick="selectAppMode('src')" class="bg-[#08ABDE] text-white p-6 rounded-2xl flex flex-col items-center justify-center gap-2 active:bg-[#0090bd] transition shadow-lg shadow-blue-200">
                    <span class="text-3xl">üîç</span>
                    <span class="font-bold text-sm">Find</span>
                </button>
            </div>
            <p class="text-[10px] text-gray-300 mt-8">ICM COMPUTERS &bull; +91 98092 86999</p>
        </div>
    </div>

    <div id="successModal" class="modal">
        <div class="bg-white w-full max-w-sm p-8 rounded-3xl text-center fade-in relative">
            <div class="mx-auto w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4">
                <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
            </div>
            <h2 class="text-2xl font-bold text-gray-900">Success!</h2>
            <p class="text-gray-500 text-sm mt-2 mb-6">Your details have been registered.</p>
            <button onclick="window.location.reload()" class="w-full bg-slate-900 text-white font-bold py-4 rounded-xl">Close</button>
        </div>
    </div>

    <header class="bg-white px-5 py-3 flex items-center justify-between shadow-sm z-10">
        <img src="logo.png" style="height: 40px; width: auto;" alt="Logo">
        <div class="text-right">
            <p class="text-[10px] font-bold text-gray-900">ICM COMPUTERS</p>
            <a href="tel:+919809286999" class="text-[10px] text-[#08ABDE] font-bold">+91 98092 86999</a>
        </div>
    </header>

    <main class="content-scroll p-4">
        
        <div id="view-reg" style="display:none;">
            <div class="mb-5 px-1">
                <h2 class="text-2xl font-bold text-gray-800">Registration</h2>
                <p class="text-gray-400 text-xs">Join our donor network</p>
            </div>
            
            <form id="regForm" class="space-y-3">
                <input type="text" name="data[Name]" placeholder="Your Name" required class="w-full p-4 rounded-xl border-none shadow-sm focus:ring-2 focus:ring-[#08ABDE]">
                <input type="tel" name="data[Phone]" placeholder="Phone Number" required pattern="[0-9]{10}" class="w-full p-4 rounded-xl border-none shadow-sm focus:ring-2 focus:ring-[#08ABDE]">
                
                <div class="grid grid-cols-2 gap-3">
                    <input type="number" name="data[Age]" placeholder="Age" required min="18" max="65" class="p-4 rounded-xl border-none shadow-sm">
                    <input type="number" name="data[Weight]" placeholder="Weight (kg)" required min="45" class="p-4 rounded-xl border-none shadow-sm">
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <select name="data[BloodGroup]" required class="p-4 rounded-xl border-none shadow-sm bg-white font-bold text-gray-700">
                        <option value="" disabled selected>Group</option>
                        <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
                        <option>O+</option><option>O-</option><option>AB+</option><option>AB-</option>
                    </select>
                    <select name="data[District]" class="p-4 rounded-xl border-none shadow-sm bg-white text-sm">
                        <option value="Kottayam" selected>Kottayam</option>
                        <option value="Alappuzha">Alappuzha</option><option value="Ernakulam">Ernakulam</option>
                        <option value="Idukki">Idukki</option><option value="Kannur">Kannur</option>
                        <option value="Kollam">Kollam</option><option value="Kozhikode">Kozhikode</option>
                        <option value="Malappuram">Malappuram</option><option value="Palakkad">Palakkad</option>
                        <option value="Pathanamthitta">Pathanamthitta</option><option value="Thiruvananthapuram">Tvpm</option>
                        <option value="Thrissur">Thrissur</option><option value="Wayanad">Wayanad</option>
                    </select>
                </div>

                <input type="text" name="data[Location]" placeholder="City / Town" required class="w-full p-4 rounded-xl border-none shadow-sm focus:ring-2 focus:ring-[#08ABDE]">
                <input type="hidden" name="data[Date]" id="dt">

                <button type="submit" id="btnSub" class="w-full bg-[#08ABDE] text-white font-bold py-4 rounded-xl mt-4 shadow-lg active:scale-95 transition-transform">
                    Register Now
                </button>
            </form>
            <div class="h-20"></div> </div>

        <div id="view-src" style="display:none;">
            <div class="bg-slate-800 p-6 rounded-3xl text-white shadow-xl mb-6">
                <h2 class="text-xl font-bold mb-1">Find Donors</h2>
                <p class="text-slate-400 text-xs mb-4">Select a blood group to search</p>
                <div class="flex gap-2">
                    <select id="searchGroup" class="flex-grow p-3 rounded-xl text-slate-900 font-bold outline-none border-none">
                        <option value="" disabled selected>Select Group</option>
                        <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
                        <option>O+</option><option>O-</option><option>AB+</option><option>AB-</option>
                    </select>
                    <button onclick="runSearch()" class="bg-[#08ABDE] px-5 rounded-xl font-bold active:bg-[#0090bd]">Go</button>
                </div>
            </div>
            
            <div id="resultsArea" class="space-y-3"></div>
            <div class="h-20"></div> </div>

    </main>

    <nav class="fixed bottom-0 w-full bg-white border-t border-gray-100 flex justify-around pb-5 pt-3 z-50">
        <button onclick="switchTab('reg')" id="navReg" class="flex flex-col items-center gap-1 w-1/2 opacity-100 transition-opacity">
            <div class="bg-blue-50 p-1.5 rounded-lg">
                <svg class="w-6 h-6 text-[#08ABDE]" fill="currentColor" viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
            </div>
            <span class="text-[10px] font-bold text-[#08ABDE]">Register</span>
        </button>
        
        <button onclick="switchTab('src')" id="navSrc" class="flex flex-col items-center gap-1 w-1/2 opacity-50 transition-opacity">
            <div class="p-1.5 rounded-lg">
                <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"/></svg>
            </div>
            <span class="text-[10px] font-bold text-gray-400">Search</span>
        </button>
    </nav>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbx26EW3BD00D6KUskqPLliVz80KlwaxCFd3uNN0fIm2uLRwqjgFPAfYX3AsYl8XRNZyeg/exec";

        function openStart() { document.getElementById('startModal').style.display = 'flex'; }

        function selectAppMode(mode) {
            document.getElementById('startModal').style.display = 'none';
            switchTab(mode);
        }

        function switchTab(tab) {
            // Toggle Views
            document.getElementById('view-reg').style.display = (tab === 'reg' ? 'block' : 'none');
            document.getElementById('view-src').style.display = (tab === 'src' ? 'block' : 'none');

            // Toggle Nav Styling
            const navReg = document.getElementById('navReg');
            const navSrc = document.getElementById('navSrc');
            
            if(tab === 'reg') {
                navReg.style.opacity = '1'; 
                navReg.querySelector('div').className = 'bg-blue-50 p-1.5 rounded-lg';
                navReg.querySelector('svg').classList.replace('text-gray-400', 'text-[#08ABDE]');
                navReg.querySelector('span').classList.replace('text-gray-400', 'text-[#08ABDE]');

                navSrc.style.opacity = '0.5';
                navSrc.querySelector('div').className = 'p-1.5 rounded-lg';
                navSrc.querySelector('svg').classList.replace('text-[#08ABDE]', 'text-gray-400');
                navSrc.querySelector('span').classList.replace('text-[#08ABDE]', 'text-gray-400');
            } else {
                navSrc.style.opacity = '1';
                navSrc.querySelector('div').className = 'bg-blue-50 p-1.5 rounded-lg';
                navSrc.querySelector('svg').classList.replace('text-gray-400', 'text-[#08ABDE]');
                navSrc.querySelector('span').classList.replace('text-gray-400', 'text-[#08ABDE]');

                navReg.style.opacity = '0.5';
                navReg.querySelector('div').className = 'p-1.5 rounded-lg';
                navReg.querySelector('svg').classList.replace('text-[#08ABDE]', 'text-gray-400');
                navReg.querySelector('span').classList.replace('text-[#08ABDE]', 'text-gray-400');
            }
        }

        // --- SUBMIT ---
        document.getElementById('regForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const btn = document.getElementById('btnSub');
            const originalText = btn.innerHTML;
            
            btn.innerHTML = '<div class="loader mx-auto"></div>';
            btn.disabled = true;
            document.getElementById('dt').value = new Date().toLocaleDateString();

            const formData = new FormData(this);
            const data = {};
            formData.forEach((val, key) => { data[key.replace('data[', '').replace(']', '')] = val; });

            fetch(API_URL, {
                method: 'POST',
                redirect: 'follow',
                headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                body: JSON.stringify(data)
            })
            .then(() => {
                document.getElementById('successModal').style.display = 'flex';
                this.reset();
                btn.innerHTML = originalText;
                btn.disabled = false;
            })
            .catch(() => {
                alert('Connection Error');
                btn.innerHTML = originalText;
                btn.disabled = false;
            });
        });

        // --- SEARCH ---
        function runSearch() {
            const group = document.getElementById('searchGroup').value;
            const area = document.getElementById('resultsArea');
            
            if(!group) return;

            area.innerHTML = '<div class="text-center py-10"><div class="loader mx-auto mb-2"></div><p class="text-xs text-gray-400">Searching...</p></div>';

            fetch(API_URL + '?BloodGroup=' + encodeURIComponent(group))
            .then(res => res.json())
            .then(data => {
                area.innerHTML = '';
                if(!data || data.length === 0) {
                    area.innerHTML = '<div class="text-center p-8 bg-white rounded-2xl"><p class="font-bold text-gray-400 text-sm">No donors found.</p></div>';
                    return;
                }
                
                data.forEach(d => {
                    const waLink = `https://wa.me/91${d.Phone}?text=Hello ${d.Name}, found you on Blood Connect. Urgent need for ${d.BloodGroup}.`;
                    
                    area.innerHTML += `
                    <div class="bg-white p-4 rounded-2xl flex justify-between items-center shadow-sm">
                        <div class="flex items-center gap-3">
                            <div class="h-10 w-10 bg-slate-100 rounded-full flex items-center justify-center text-xs font-black text-[#08ABDE]">${d.BloodGroup}</div>
                            <div>
                                <h3 class="font-bold text-sm text-gray-900">${d.Name}</h3>
                                <p class="text-[10px] text-gray-400 font-bold uppercase">${d.Location}</p>
                            </div>
                        </div>
                        <a href="${waLink}" class="bg-[#25D366] h-10 w-10 rounded-xl flex items-center justify-center text-white shadow-lg active:scale-90 transition">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                        </a>
                    </div>`;
                });
            });
        }
    </script>
</body>
</html>